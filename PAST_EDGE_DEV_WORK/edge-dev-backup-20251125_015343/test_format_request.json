{
  "source_code": "# daily_para_backside_lite_scan.py\n# Daily-only \"A+ para, backside\" scan — lite mold.\n# Trigger: D-1 (or D-2) fits; trade day (D0) must gap & open > D-1 high.\n# D-1 must take out D-2 high and close above D-2 close.\n# Adds absolute D-1 volume floor: d1_volume_min.\n\nimport pandas as pd, numpy as np, requests\nfrom datetime import datetime\nfrom concurrent.futures import ThreadPoolExecutor, as_completed\n\n# ───────── config ─────────\nsession  = requests.Session()\nAPI_KEY  = \"Fm7brz4s23eSocDErnL68cE7wspz2K1I\"\nBASE_URL = \"https://api.polygon.io\"\nMAX_WORKERS = 6\n\nPRINT_FROM = \"2025-01-01\"  # set None to keep all\nPRINT_TO   = None\n\n# ───────── knobs ─────────\nP = {\n    # hard liquidity / price\n    \"price_min\"        : 8.0,\n    \"adv20_min_usd\"    : 30_000_000,\n\n    # backside context (absolute window)\n    \"abs_lookback_days\": 1000,\n    \"abs_exclude_days\" : 10,\n    \"pos_abs_max\"      : 0.75,\n\n    # trigger mold (evaluated on D-1 or D-2)\n    \"trigger_mode\"     : \"D1_or_D2\",   # \"D1_only\" or \"D1_or_D2\"\n    \"atr_mult\"         : .9,\n    \"vol_mult\"         : 0.9,         # max(D-1 vol/avg, D-2 vol/avg)\n\n    # Relative D-1 vol (optional). Set to None to disable.\n    \"d1_vol_mult_min\"  : None,         # e.g., 1.25\n\n    # NEW: Absolute D-1 volume floor (shares). Set None to disable.\n    \"d1_volume_min\"    : 15_000_000,   # e.g., require ≥ 20M shares on D-1\n\n    \"slope5d_min\"      : 3.0,\n    \"high_ema9_mult\"   : 1.05,\n\n    # trade-day (D0) gates\n    \"gap_div_atr_min\"   : .75,\n    \"open_over_ema9_min\": .9,\n    \"d1_green_atr_min\"  : 0.30,\n    \"require_open_gt_prev_high\": True,\n\n    # relative requirement\n    \"enforce_d1_above_d2\": True,\n}\n\n# ───────── universe ─────────\nSYMBOLS = [\n    'MSTR','SMCI','DJT','BABA','TCOM','AMC','SOXL','MRVL','TGT','DOCU','ZM','DIS',\n    'NFLX','SNAP','RBLX','META','SE','NVDA','AAPL','MSFT','GOOGL','AMZN','TSLA',\n    'AMD','INTC','BA','PYPL','QCOM','ORCL','KO','PEP','ABBV','JNJ','CRM','BAC',\n    'JPM','WMT','CVX','XOM','COP','RTX','SPGI','GS','HD','LOW','COST','UNH','NKE',\n    'LMT','HON','CAT','LIN','ADBE','AVGO','TXN','ACN','UPS','BLK','PM','ELV','VRTX',\n    'ZTS','NOW','ISRG','PLD','MS','MDT','WM','GE','IBM','BKNG','FDX','ADP','EQIX',\n    'DHR','SNPS','REGN','SYK','TMO','CVS','INTU','SCHW','CI','APD','SO','MMC','ICE',\n    'FIS','ADI','CSX','LRCX','GILD','RIVN','PLTR','SNOW','SPY','QQQ','IWM','RIOT',\n    'MARA','COIN','MRNA','CELH','UPST','AFRM','DKNG'\n]\n\n# ───────── fetch ─────────\ndef fetch_daily(tkr: str, start: str, end: str) -> pd.DataFrame:\n    url = f\"{BASE_URL}/v2/aggs/ticker/{tkr}/range/1/day/{start}/{end}\"\n    r   = session.get(url, params={\"apiKey\": API_KEY, \"adjusted\":\"true\", \"sort\":\"asc\", \"limit\":50000})\n    r.raise_for_status()\n    rows = r.json().get(\"results\", [])\n    if not rows: return pd.DataFrame()\n    return (pd.DataFrame(rows)\n            .assign(Date=lambda d: pd.to_datetime(d[\"t\"], unit=\"ms\", utc=True))\n            .rename(columns={\"o\":\"Open\",\"h\":\"High\",\"l\":\"Low\",\"c\":\"Close\",\"v\":\"Volume\"})\n            .set_index(\"Date\")[[\"Open\",\"High\",\"Low\",\"Close\",\"Volume\"]]\n            .sort_index())\n\n# ───────── main ─────────\nif __name__ == \"__main__\":\n    fetch_start = \"2020-01-01\"\n    fetch_end   = datetime.today().strftime(\"%Y-%m-%d\")\n\n    results = []\n    with ThreadPoolExecutor(max_workers=MAX_WORKERS) as exe:\n        futs = {exe.submit(scan_symbol, s, fetch_start, fetch_end): s for s in SYMBOLS}\n        for fut in as_completed(futs):\n            df = fut.result()\n            if df is not None and not df.empty:\n                results.append(df)\n\n    if results:\n        out = pd.concat(results, ignore_index=True)\n        if PRINT_FROM:\n            out = out[pd.to_datetime(out[\"Date\"]) >= pd.to_datetime(PRINT_FROM)]\n        if PRINT_TO:\n            out = out[pd.to_datetime(out[\"Date\"]) <= pd.to_datetime(PRINT_TO)]\n        out = out.sort_values([\"Date\",\"Ticker\"], ascending=[False, True])\n        pd.set_option(\"display.max_columns\", None, \"display.width\", 0)\n        print(\"\\nBackside A+ (lite) — trade-day hits:\\n\")\n        print(out.to_string(index=False))\n    else:\n        print(\"No hits. Consider relaxing high_ema9_mult / gap_div_atr_min / d1_volume_min.\")",
  "format_type": "scan_optimization",
  "preserve_logic": true,
  "add_documentation": true,
  "optimize_performance": true,
  "current_issues": ["Missing scan_symbol function", "API key exposure", "No error handling for network requests", "No parameter validation"]
}